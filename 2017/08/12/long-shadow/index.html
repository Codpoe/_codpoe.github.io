<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
<title>
    
        CSS实现长投影
    
</title>
<meta name="author" content="Codpoe">
<meta name="description" content="An elegant blog about tech and life">
<meta name="keywords" content="Blog, Tech, Front-End">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">


    <link rel="stylesheet" href="/css/post.bundle.css">
</head>
<body>
    <header class="header-wrapper 
     
    ">

    <div class="header">
        <div class="header__normal header__normal--is-post">
            <div class="left">
                <a href="/">
                    <h1 class="header__name">
                        Codpoe
                    </h1>
                </a>
            </div>
            <ul class="right menu-list">
                
                
                    <li>
                        
                            <a
                                href="/" 
                                class="normal-menu "
                                target="_self">
                                首页
                            </a>
                        
                    </li>
                
                
                    <li>
                        
                            <span class="category">
                                分类&nbsp;<i class="fa fa-angle-down"></i>
                                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">1</span></li></ul>
                            </span>
                        
                    </li>
                
                
                    <li>
                        
                            <a
                                href="/archives" 
                                class="normal-menu "
                                target="_self">
                                归档
                            </a>
                        
                    </li>
                
                
                    <li>
                        
                            <a
                                href="/about" 
                                class="normal-menu "
                                target="_self">
                                关于
                            </a>
                        
                    </li>
                
                
                    <li>
                        
                            <a
                                href="/resume" 
                                class="normal-menu "
                                target="_blank">
                                简历
                            </a>
                        
                    </li>
                
            </ul>
            <div class="menu-bar">
                <div class="menu-bar__middle"></div>
            </div>
        </div>
        
        <div class="header__post-hidden">
            <div class="header__post-visible">
                <div class="header__post-holder"></div>
                <div class="header__post">
                    <div class="left">
                        <h1 class="header__post-name">
                            CSS实现长投影
                        </h1>
                    </div>
                    <div class="right">
                        <ul class="share-links">
                            <li>
                                <a class="share-link"
                                    href="http://service.weibo.com/share/share.php?appkey=3131596266&title=分享文章「CSS实现长投影」&url=http://codpoe.me/2017/08/12/long-shadow/index.html"
                                    target="_blank">
                                    <i class="fa fa-weibo"></i> 分享到微博
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <div class="header__drawer">
        <ul class="drawer__menu-list">
        
        
        
            <li>
                <a 
                    href="/" 
                    class="drawer__menu "
                    target="_self">
                    首页
                </a>
            </li>
        
        
        
        
        
        
        
            <li>
                <a 
                    href="/archives" 
                    class="drawer__menu "
                    target="_self">
                    归档
                </a>
            </li>
        
        
        
        
            <li>
                <a 
                    href="/about" 
                    class="drawer__menu "
                    target="_self">
                    关于
                </a>
            </li>
        
        
        
        
            <li>
                <a 
                    href="/resume" 
                    class="drawer__menu "
                    target="_blank">
                    简历
                </a>
            </li>
        
        
        </ul>
    </div>

    <div class="window-mask"></div>
</header>



    <div class="wrapper">
        <div class="container">
            <div class="post">
    <header class="title-wrapper">
        
            <h1>
                <span class="title">
                    CSS实现长投影
                </span>
            </h1>
        
        
        <ul class="description">
            <li>
                Aug 12, 2017
            </li>
            
            <li>
            
                <a href="/categories/前端">
                    
                        前端
                    
                </a>
            
            </li>
            
        </ul>
        
    </header>
    
    <section class="markdown-body">
        
            <p>随着 Google Material Design 的推进，长投影效果也变得越来越常见，很多应用的图标上都有长投影的应用。在 PS 和 Sketch 里都能简单地实现长投影，那么如果我要在网页上显示长投影是不是也得用 PS 或者 Sketch 呢？其实不然，利用 CSS 的 <code>text-shadow</code>属性也能实现长投影。</p>
<a id="more"></a>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fih1ssd9b5j30go0ciq3w.jpg" alt=""></p>
<h2 id="text-shadow"><a href="#text-shadow" class="headerlink" title="text-shadow"></a>text-shadow</h2><p><code>text-shadow</code>接收一组以<code>,</code>分隔的值，而每个值可由 x 轴偏移、y 轴偏移、颜色、模糊半径组成，颜色和模糊半径都是可选的：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">text-shadow</span>: 14<span class="selector-tag">px</span> 14<span class="selector-tag">px</span> 4<span class="selector-tag">px</span> <span class="selector-tag">rgba</span>(51,51,51,<span class="selector-class">.2</span>);</div></pre></td></tr></table></figure></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fih0bgqom6j30do040aa6.jpg" alt=""></p>
<p>显然，单个<code>text-shadow</code>的值仅仅是一层阴影罢了，顶多就是让文字有浮起来的感觉，而文字本身看起来仍然只是薄薄的一层。但是长投影是让文字看起来有高度，有体积。其实很明显，要想实现长投影，必须让很多层阴影连续不断地叠加、铺展起来，幸好<code>text-shadow</code>是支持添加多个值，于是我们可以这样：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">text-shadow</span>: 1<span class="selector-tag">px</span> 1<span class="selector-tag">px</span> <span class="selector-tag">rgba</span>(51,51,51,<span class="selector-class">.7</span>), 5<span class="selector-tag">px</span> 5<span class="selector-tag">px</span> <span class="selector-tag">rgba</span>(51,51,51,<span class="selector-class">.5</span>), 10<span class="selector-tag">px</span> 10<span class="selector-tag">px</span> <span class="selector-tag">rgba</span>(51,51,51,<span class="selector-class">.3</span>);</div></pre></td></tr></table></figure></p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fih0a6qc4cj30dg040mxc.jpg" alt=""></p>
<p>这里列出来的几个值是完全不足以达到长投影的要求的。一方面是阴影的偏移差要足够小，如果偏移差大了，整个长投影的边缘会有很多锯齿；二是各个阴影的色差变化要均匀，一般来说，长投影的颜色是越远越深的，如果色差不均匀，出来的效果会不够真实。那怎么解决呢？</p>
<h2 id="利用JS生成text-shadow"><a href="#利用JS生成text-shadow" class="headerlink" title="利用JS生成text-shadow"></a>利用JS生成text-shadow</h2><p>既然需要更精细地控制<code>text-shadow</code>的各个阴影值，那么就引入 JS 来解决问题吧。</p>
<ul>
<li><p>首先需要一个初始的颜色，一般在背景色的基础上再加深。</p>
</li>
<li><p>利用循环生成阴影，循环的迭代变量差设为 0.5，循环次数根据长投影的长度而定。</p>
</li>
<li><p>在每次循环里面根据当前的循环进度设置颜色透明度，这里设的初始透明度是 0.6，然后总的阴影值拼接上此次循环的阴影值。</p>
</li>
</ul>
<p>这里的<code>0.5</code>、<code>0.6</code>都是经验值，可以随意修改。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLongShadow</span>(<span class="params">startColor = <span class="string">'212,213,213'</span>, shadowLength = <span class="number">10</span></span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> textShadow = <span class="string">''</span>;</div><div class="line">    <span class="keyword">let</span> alpha;</div><div class="line">    <span class="keyword">let</span> color;</div><div class="line">    <span class="keyword">let</span> seperator = <span class="string">','</span>;</div><div class="line"> </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0.5</span>; i &lt;= shadowLength; i=i+<span class="number">0.5</span>) &#123;</div><div class="line">        alpha = (<span class="number">1</span> - (i - <span class="number">0.5</span>) / shadowLength) * <span class="number">0.6</span>;</div><div class="line">        color = <span class="string">`rgba(<span class="subst">$&#123;startColor&#125;</span>, <span class="subst">$&#123;alpha&#125;</span>)`</span>;</div><div class="line">        <span class="keyword">if</span> (i === shadowLength) &#123;</div><div class="line">            seperator = <span class="string">''</span>;</div><div class="line">        &#125;</div><div class="line">        textShadow += <span class="string">`<span class="subst">$&#123;i&#125;</span>px <span class="subst">$&#123;i&#125;</span>px <span class="subst">$&#123;color&#125;</span><span class="subst">$&#123;seperator&#125;</span>`</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> textShadow;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后就可以通过<code>element.style.textShadow = getLongShadow()</code>或者其他什么方式设置样式了。<br><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fih08wb7euj30e403mdfx.jpg" alt=""></p>
<h2 id="动态生成随鼠标而动的text-shadow"><a href="#动态生成随鼠标而动的text-shadow" class="headerlink" title="动态生成随鼠标而动的text-shadow"></a>动态生成随鼠标而动的text-shadow</h2><p>知道了怎么生成text-shaodw，那么现在再加一点效果，就是生成随鼠标而动的长投影，长投影始终朝着鼠标所在的方位，并且鼠标离目标文字越远则长投影越长。</p>
<ul>
<li><p>首先需确定目标文字的 x、y 坐标和屏幕的宽高，算出以目标文字为中心的屏幕边框偏移。</p>
</li>
<li><p>然后在鼠标的<code>mousemove</code>事件中取得鼠标的 x、y 坐标，同理算出其与目标文字的偏移，再将得到的偏移跟上面得到的屏幕偏移比较得出 x、y 各自方向的阴影偏移率。</p>
</li>
</ul>
<p>由于要根据 x、y 方向上的偏移率计算偏移方向，所以要稍微修改下上面的<code>getLongShadow</code>方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 增加了 ratioX、ratioY 参数</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLongShadow</span>(<span class="params">startColor = <span class="string">'212,213,213'</span>, shadowLength = <span class="number">10</span>, ratioX, ratioY</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> textShadow = <span class="string">''</span>;</div><div class="line">    <span class="keyword">let</span> alpha;</div><div class="line">    <span class="keyword">let</span> color;</div><div class="line">    <span class="keyword">let</span> seperator = <span class="string">','</span>;</div><div class="line"> </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0.5</span>; i &lt;= shadowLength; i=i+<span class="number">0.5</span>) &#123;</div><div class="line">        alpha = (<span class="number">1</span> - (i - <span class="number">0.5</span>) / shadowLength) * <span class="number">0.6</span>;</div><div class="line">        color = <span class="string">`rgba(<span class="subst">$&#123;startColor&#125;</span>, <span class="subst">$&#123;alpha&#125;</span>)`</span>;</div><div class="line">        <span class="keyword">if</span> (i === shadowLength) &#123;</div><div class="line">            seperator = <span class="string">''</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// textShadow += `$&#123;i&#125;px $&#123;i&#125;px $&#123;color&#125;$&#123;seperator&#125;`;</span></div><div class="line">        textShadow += <span class="string">`<span class="subst">$&#123;i * ratioX&#125;</span>px <span class="subst">$&#123;i * ratiaY&#125;</span>px <span class="subst">$&#123;color&#125;</span><span class="subst">$&#123;seperator&#125;</span>`</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> textShadow;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>计算偏移：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> rect = element.getBoundingClientRect();</div><div class="line"><span class="keyword">let</span> focus = &#123; <span class="attr">x</span>: rect.left, <span class="attr">y</span>: rect.top &#125;;</div><div class="line"><span class="keyword">let</span> mouse = &#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;;</div><div class="line"><span class="keyword">let</span> width = (<span class="built_in">window</span>.innerWidth - focus.x) * <span class="number">3</span> / <span class="number">4</span>;</div><div class="line"><span class="keyword">let</span> height = (<span class="built_in">window</span>.innerHeight - focus.y) * <span class="number">3</span> / <span class="number">4</span>;</div><div class="line"><span class="keyword">let</span> ratioX;</div><div class="line"><span class="keyword">let</span> ratioY;</div><div class="line"> </div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'mousemove'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</div><div class="line">    mouse.x = ev.clientX;</div><div class="line">    mouse.y = ev.clientY;</div><div class="line">    ratioX = (mouse.x - focus.x) / width;</div><div class="line">    ratioY = (mouse.y - focus.y) / height;</div><div class="line">    element.style.textShadow = getLongShadow(<span class="string">'212,213,213'</span>, <span class="number">10</span>, ratioX, ratioY);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这里的<code>3/4</code>是为了不让阴影扯得过长，可以根据实际情况修改。<br><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fih1yffmt1g30ac0bn1kz.gif" alt=""></p>
<script async src="//jsfiddle.net/Codpoe/ky4t2nju/2/embed/"></script>

<h2 id="没了"><a href="#没了" class="headerlink" title="没了"></a>没了</h2><p>其实在涉及坐标运算的时候，比如<code>mousemove</code>事件，canvas 的绘制等，有时会误以为 x 和 y 有密切关联，其实不然。当想法陷入僵局时，分而治之的思想可能会比较有用，也就是将 x 和 y 分开考虑和计算。</p>

        
    </section>
    
    
</div>
            <div class="prev-next">

    <a class="prev" href="/2017/09/26/koa-compose/"><i class="fa fa-angle-left"></i> 听说你用过koa？写一下compose吧</a>


    <a class="next" href="/2017/06/06/scope-chain/">JS的作用域链 <i class="fa fa-angle-right"></i></a>

</div>


            <section class="comments">
                
    <div id="disqus_thread">
    </div>
    <script>
        var disqus_shortname = 'codpoe';
        var disqus_config = function() {
            this.page.url = 'http://codpoe.me/2017/08/12/long-shadow/';
            this.page.identifier = '2017/08/12/long-shadow/';
        };
        (function() {
            var d = document,
                s = d.createElement('script');
            s.async = true;
            s.setAttribute('data-timestamp', +new Date());
            s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>
        Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>

    
                            
            </section>
        </div>
        <footer class="footer">
    <div class="copyright">
        <i class="fa fa-copyright"></i>&nbsp;2018&nbsp;&nbsp;<i class="fa fa-heart"></i>&nbsp;&nbsp;Codpoe
    </div>
    <div class="info">
        Powered by <a href="https://hexo.io/">Hexo</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Theme - <a href="https://github.com/codpoe/hexo-theme-poem/">Poem</a>
    </div>
    <div class="icp">粤ICP备16079355号-1</div>
</footer>
    </div>
    <aside class="toc-wrapper">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#text-shadow"><span class="toc-text">text-shadow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#利用JS生成text-shadow"><span class="toc-text">利用JS生成text-shadow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态生成随鼠标而动的text-shadow"><span class="toc-text">动态生成随鼠标而动的text-shadow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#没了"><span class="toc-text">没了</span></a></li></ol>
</aside>
    
    <script src="/js/post.bundle.js"></script>
</body>
</html>